(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[937],{8656:function(e,t,a){Promise.resolve().then(a.bind(a,3460))},3460:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return o}});var r=a(3827),n=a(4090),s=a(7907),l=a(8792),i=a(2406);function o(){let e=(0,s.useRouter)(),t=(0,s.useSearchParams)().get("email"),{setUser:a}=(0,i.useAuth)(),[o,u]=(0,n.useState)(""),[c,d]=(0,n.useState)(""),[m,h]=(0,n.useState)(""),[f,y]=(0,n.useState)(!1),[g,x]=(0,n.useState)(5),p=async r=>{if(r.preventDefault(),t&&o){y(!0);try{let r=await fetch("/api/auth/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,code:o})}),n=await r.json();if(!r.ok)throw Error(n.error||"Email doğrulama sırasında bir hata oluştu");if(n.user&&n.token){localStorage.setItem("user",JSON.stringify(n.user)),localStorage.setItem("token",n.token),a(n.user),h("Email adresiniz başarıyla doğrulandı! Ana sayfaya y\xf6nlendiriliyorsunuz...");let t=setInterval(()=>{x(a=>a<=1?(clearInterval(t),"student"===n.user.role?e.push("/egitmenler"):e.push("/"),0):a-1)},1e3);return()=>clearInterval(t)}{h("Email adresiniz başarıyla doğrulandı! Giriş sayfasına y\xf6nlendiriliyorsunuz...");let t=setInterval(()=>{x(a=>a<=1?(clearInterval(t),e.push("/auth/login"),0):a-1)},1e3);return()=>clearInterval(t)}}catch(e){d(e instanceof Error?e.message:"Email doğrulama sırasında bir hata oluştu")}finally{y(!1)}}};return t?(0,r.jsx)("div",{className:"w-[300px] mx-auto",children:(0,r.jsxs)("div",{className:"space-y-3 w-auto",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-[#994D1C] text-center",children:"Email Doğrulama"}),(0,r.jsx)("p",{className:"mt-1 text-sm text-[#6B3416] text-center",children:"Email adresinize g\xf6nderilen 6 haneli doğrulama kodunu giriniz."})]}),m?(0,r.jsxs)("div",{className:"text-center space-y-2",children:[(0,r.jsx)("div",{className:"text-[#994D1C] font-medium",children:m}),(0,r.jsxs)("p",{className:"text-[#6B3416]",children:[g," saniye i\xe7inde y\xf6nlendirileceksiniz..."]}),(0,r.jsx)(l.default,{href:"/auth/login",className:"text-[#FF8B5E] hover:text-[#994D1C] transition-colors font-medium",children:"Hemen Giriş Yap"})]}):(0,r.jsxs)("form",{onSubmit:p,className:"space-y-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"code",className:"block text-sm font-medium text-[#6B3416]",children:"Doğrulama Kodu"}),(0,r.jsx)("input",{type:"text",id:"code",value:o,onChange:e=>u(e.target.value),placeholder:"123456",className:"mt-1 block w-full rounded-md border-[#FFB996] shadow-sm focus:border-[#FF8B5E] focus:ring focus:ring-[#FF8B5E] focus:ring-opacity-50",maxLength:6,required:!0})]}),c&&(0,r.jsx)("div",{className:"text-red-600 text-sm font-medium",children:c}),(0,r.jsx)("button",{type:"submit",disabled:f||!o,className:"w-full bg-gradient-to-r from-[#FF8B5E] to-[#FFB996] text-white font-semibold py-2 px-4 rounded-md hover:from-[#994D1C] hover:to-[#FF8B5E] transition-all duration-300 shadow-md hover:shadow-lg disabled:opacity-50",children:f?"Doğrulanıyor...":"Doğrula"})]})]})}):(0,r.jsx)("div",{className:"max-w-md mx-auto",children:(0,r.jsxs)("div",{className:"text-center space-y-4",children:[(0,r.jsx)("div",{className:"text-[#994D1C] font-medium",children:"Ge\xe7ersiz veya s\xfcresi dolmuş doğrulama bağlantısı."}),(0,r.jsx)(l.default,{href:"/auth/login",className:"text-[#FF8B5E] hover:text-[#994D1C] transition-colors font-medium",children:"Giriş sayfasına d\xf6n"})]})})}},2406:function(e,t,a){"use strict";a.r(t),a.d(t,{AuthProvider:function(){return i},useAuth:function(){return o}});var r=a(3827),n=a(4090),s=a(7907);let l=(0,n.createContext)({user:null,loading:!1,error:null,login:async()=>{},register:async()=>{},logout:async()=>{},setUser:()=>{}});function i(e){let{children:t}=e,[a,i]=(0,n.useState)(null),[o,u]=(0,n.useState)(!0),[c,d]=(0,n.useState)(null),[m,h]=(0,n.useState)(!1),f=(0,s.useRouter)();(0,n.useEffect)(()=>{h(!0);try{let e=localStorage.getItem("user");if(e){let t=JSON.parse(e);i(t)}}catch(e){console.error("Error loading user from localStorage:",e)}finally{u(!1)}},[]);let y=async e=>{u(!0),d(null);try{let t=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),a=await t.json();if(403===t.status&&a.needsVerification){d("L\xfctfen \xf6nce email adresinizi doğrulayın"),f.push("/auth/verify?email=".concat(encodeURIComponent(a.email)));return}if(!t.ok)throw Error(a.error||"Giriş yapılırken bir hata oluştu");i(a.user),localStorage.setItem("user",JSON.stringify(a.user)),localStorage.setItem("token",a.token),"student"===a.user.role?f.push("/egitmenler"):f.push("/")}catch(e){throw d(e.message),e}finally{u(!1)}},g=async e=>{u(!0),d(null);try{let t=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),a=await t.json();if(!t.ok)throw Error(a.error||"Kayıt olurken bir hata oluştu");let r=null;a.user?(r=a.user,console.log("API yanıtı result.user i\xe7inde bulundu:",r)):a.id||a._id||a.name||a.email?(r=a,console.log("API yanıtı doğrudan result i\xe7inde bulundu:",r)):(console.log("API yanıtında kullanıcı verisi bulunamadı, ge\xe7ici kullanıcı oluşturuluyor"),r={id:Math.random().toString(36).substring(2,15),name:e.name,email:e.email,role:e.role,university:e.university,isVerified:!1}),console.log("Kullanıcının kayıt formunda se\xe7tiği rol:",e.role),console.log("API yanıtında gelen rol (varsa):",r.role);let n={id:r.id||r._id||"",name:r.name||e.name||"",email:r.email||e.email||"",role:e.role||r.role||"student",university:r.university||e.university||"",isVerified:r.isVerified||!1,expertise:r.expertise};console.log("Doğrulanmış kullanıcı verisi:",n),f.push("/auth/verify?email=".concat(encodeURIComponent(n.email)))}catch(e){throw console.error("Kayıt hatası:",e),d(e.message),e}finally{u(!1)}},x=async()=>{u(!0),d(null);try{let e=await fetch("/api/auth/logout",{method:"POST"});if(!e.ok){let t=await e.json();throw Error(t.error||"\xc7ıkış yapılırken bir hata oluştu")}i(null),localStorage.removeItem("user"),localStorage.removeItem("token"),f.push("/auth/login")}catch(e){throw d(e.message),e}finally{u(!1)}};return m?(0,r.jsx)(l.Provider,{value:{user:a,loading:o,error:c,login:y,register:g,logout:x,setUser:i},children:t}):(0,r.jsx)(l.Provider,{value:{user:null,loading:!0,error:null,login:async()=>{},register:async()=>{},logout:async()=>{},setUser:()=>{}},children:t})}function o(){return(0,n.useContext)(l)}},7907:function(e,t,a){"use strict";var r=a(5313);a.o(r,"usePathname")&&a.d(t,{usePathname:function(){return r.usePathname}}),a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}}),a.o(r,"useSearchParams")&&a.d(t,{useSearchParams:function(){return r.useSearchParams}})}},function(e){e.O(0,[792,971,69,744],function(){return e(e.s=8656)}),_N_E=e.O()}]);