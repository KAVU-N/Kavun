exports.id=7226,exports.ids=[7226],exports.modules={58359:()=>{},93739:()=>{},88045:(e,t,r)=>{"use strict";r.d(t,{Z:()=>l});var s=r(95344),n=r(3729),i=r(89410),o=r(98470),a=r(67296);let l=({instructor:e,onClose:t,containerStyles:r,embedded:l=!1})=>{let{user:c}=(0,a.useAuth)(),[d,m]=(0,n.useState)([]),[u,h]=(0,n.useState)(""),[x,f]=(0,n.useState)(!1),[p,g]=(0,n.useState)(!0),[y,j]=(0,n.useState)(!1),b=(0,n.useRef)(null),v=(0,n.useRef)(null),w=(0,n.useRef)(null),k=(0,n.useRef)(null),[N,F]=(0,n.useState)(400),S=(0,n.useRef)(void 0),[_,M]=(0,n.useState)(!1);(0,n.useEffect)(()=>{e._id&&c&&B()},[e._id,c]),(0,n.useEffect)(()=>{if(c)try{console.log("Socket.io bağlantısı kuruluyor...");let t=(0,o.ZP)(process.env.NEXT_PUBLIC_SOCKET_URL||"http://localhost:5000",{transports:["polling","websocket"],reconnectionAttempts:5,reconnectionDelay:1e3,timeout:2e4,forceNew:!0,autoConnect:!0});return b.current=t,t.on("connect",()=>{console.log("Socket.io bağlantısı kuruldu, ID:",t.id),c?.id&&(t.emit("join",c.id),console.log("Kullanıcı odasına katıldı:",c.id))}),t.on("connect_error",e=>{console.error("Socket.io bağlantı hatası:",e)}),t.on("connect_timeout",()=>{console.error("Socket.io bağlantı zaman aşımı")}),t.on("reconnect",e=>{console.log(`Socket.io yeniden bağlandı, deneme: ${e}`)}),t.on("reconnect_error",e=>{console.error("Socket.io yeniden bağlanma hatası:",e)}),t.on("reconnect_failed",()=>{console.error("Socket.io yeniden bağlanma başarısız")}),t.on("receive-message",t=>{if(console.log("Yeni mesaj alındı:",t),t.sender===e._id&&t.receiver===c?.id||t.sender===c?.id&&t.receiver===e._id){let e={sender:t.sender,receiver:t.receiver,content:t.content,createdAt:new Date,read:!1,isMine:t.sender===c?.id};m(t=>[...t,e])}}),t.on("user-typing",t=>{t.sender===e._id&&(f(!0),S.current&&clearTimeout(S.current),S.current=setTimeout(()=>{f(!1)},3e3))}),()=>{b.current&&(console.log("Socket.io bağlantısı kapatılıyor..."),b.current.disconnect())}}catch(e){console.error("Socket.io bağlantısı kurulurken hata:",e)}},[e._id,c]),(0,n.useEffect)(()=>{w.current&&F(w.current.scrollHeight)},[d]);let B=async()=>{if(e._id&&c){g(!0);try{let t=localStorage.getItem("token");if(!t){console.error("Token bulunamadı");return}let r=await fetch(`/api/messages?receiverId=${e._id}`,{headers:{Authorization:`Bearer ${t}`}});if(!r.ok)throw Error(`Mesajlar y\xfcklenirken bir hata oluştu: ${r.status}`);let s=await r.json();if(console.log("API yanıtı:",s),s&&Array.isArray(s.messages)){let e=s.messages.map(e=>({...e,isMine:e.sender===c?.id}));m(e)}else if(s&&Array.isArray(s)){let e=s.map(e=>({...e,isMine:e.sender===c?.id}));m(e)}else console.error("Beklenmeyen API yanıt formatı:",s),m([]);setTimeout(D,300)}catch(e){console.error("Mesajlar y\xfcklenirken hata oluştu:",e)}finally{g(!1)}}},A=async t=>{if(t.preventDefault(),t.stopPropagation(),u.trim()&&c)try{let t=localStorage.getItem("token");if(!t){console.error("Token bulunamadı");return}let r={sender:c.id,receiver:e._id,content:u.trim(),createdAt:new Date,read:!1,isMine:!0};m(e=>[...e,r]),h(""),setTimeout(D,100),b.current&&b.current.emit("send-message",{sender:c.id,receiver:e._id,content:u.trim()});let s=await fetch("/api/messages",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({receiver:e._id,content:u.trim()})});s.ok||console.error("Mesaj g\xf6nderilirken bir hata oluştu:",s.status)}catch(e){console.error("Mesaj g\xf6nderilirken hata oluştu:",e)}},D=()=>{k.current&&(k.current.scrollTop=k.current.scrollHeight)},E={position:l?"relative":"fixed",right:l?void 0:"20px",bottom:l?void 0:"20px",height:l?"100%":"350px",maxHeight:l?"100%":"350px",width:l?"100%":"384px",zIndex:40,display:"flex",flexDirection:"column",borderRadius:l?"0.5rem":"0.75rem",overflow:"hidden",boxShadow:l?"none":"0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",transition:"all 0.3s ease",...r};return(0,s.jsxs)("div",{ref:w,style:{...E,display:"flex",flexDirection:"column",height:l?"calc(100vh - 200px)":_?"50px":"300px",maxHeight:l?"calc(100vh - 200px)":_?"50px":"300px",transition:"height 0.3s ease, max-height 0.3s ease"},className:"bg-white",children:[(0,s.jsxs)("div",{className:"bg-gradient-to-r from-[#FFB996] to-[#FF8B5E] p-2 flex items-center justify-between cursor-pointer",style:{flexShrink:0},onClick:()=>!l&&M(!_),children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsxs)("div",{className:"w-8 h-8 rounded-full bg-white flex items-center justify-center mr-3 relative",children:[s.jsx("span",{className:"text-[#FF8B5E] font-bold",children:e.name.charAt(0)}),Array.isArray(d)&&d.filter(t=>!t.read&&t.sender===e._id).length>0&&s.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center text-xs text-white font-bold",children:d.filter(t=>!t.read&&t.sender===e._id).length})]}),(0,s.jsxs)("div",{children:[s.jsx("h3",{className:"text-white font-medium text-sm",children:e.name}),s.jsx("p",{className:"text-white/70 text-xs",children:e.university})]})]}),(0,s.jsxs)("div",{className:"flex items-center",children:[!_&&t&&s.jsx("button",{onClick:e=>{e.stopPropagation(),t()},className:"text-white hover:text-white/80",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),!l&&s.jsx("div",{className:"ml-2 text-white",children:_?s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})}):s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),(l||!_)&&(0,s.jsxs)(s.Fragment,{children:[s.jsx("div",{ref:k,className:"overflow-y-auto p-4 bg-[#FFFBF8]",style:{flexGrow:1,height:"calc(100% - 90px)"},onClick:e=>e.stopPropagation(),children:p?s.jsx("div",{className:"flex items-center justify-center h-full",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-[#FF8B5E]"})}):0===d.length?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-center text-gray-500",children:[s.jsx(i.default,{src:"/images/chat-empty.svg",alt:"No messages",width:100,height:100,className:"mb-4 opacity-50"}),s.jsx("p",{className:"text-sm",children:"Hen\xfcz mesaj yok. Sohbeti başlatmak i\xe7in bir mesaj g\xf6nder!"})]}):(0,s.jsxs)(s.Fragment,{children:[d.map((e,t)=>{let r=0===t||d[t-1].sender!==e.sender,n=t===d.length-1||d[t+1].sender!==e.sender;return s.jsx("div",{className:`flex ${e.isMine?"justify-end":"justify-start"} mb-2`,children:(0,s.jsxs)("div",{className:`max-w-[75%] rounded-lg px-2 py-1 ${e.isMine?"bg-gradient-to-r from-[#FFB996] to-[#FF8B5E] text-white rounded-tr-none":"bg-white border border-[#FFE5D9] text-gray-800 rounded-tl-none"} ${r?"mt-2":"mt-1"} ${n?"mb-2":"mb-1"}`,children:[s.jsx("div",{className:"text-sm",children:e.content}),(0,s.jsxs)("div",{className:`flex justify-end ${e.isMine?"text-white/70":"text-gray-500"}`,style:{fontSize:"0.5rem",lineHeight:"0.7rem",marginTop:"3px"},children:[new Date(e.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),e.isMine&&s.jsx("span",{className:"ml-1",children:"✓"})]})]})},e._id||t)}),x&&(0,s.jsxs)("div",{className:"flex items-center text-gray-500 text-sm mt-2",children:[(0,s.jsxs)("div",{className:"flex space-x-1 mr-2",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-gray-400 animate-bounce",style:{animationDelay:"0ms"}}),s.jsx("div",{className:"w-2 h-2 rounded-full bg-gray-400 animate-bounce",style:{animationDelay:"150ms"}}),s.jsx("div",{className:"w-2 h-2 rounded-full bg-gray-400 animate-bounce",style:{animationDelay:"300ms"}})]}),(0,s.jsxs)("span",{children:[e.name," yazıyor..."]})]}),s.jsx("div",{ref:v})]})}),s.jsx("div",{className:"bg-white border-t border-[#FFE5D9] p-3",style:{flexShrink:0,minHeight:"70px",position:"relative",bottom:0,left:0,right:0,zIndex:10,width:"100%"},onClick:e=>e.stopPropagation(),children:s.jsx("form",{onSubmit:A,className:"w-full h-full",children:(0,s.jsxs)("div",{className:"flex items-center w-full h-full space-x-2",children:[s.jsx("input",{type:"text",value:u,onChange:e=>h(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),e.stopPropagation(),A(e))},placeholder:"Mesajınızı yazın...",className:"flex-1 border border-[#FFE5D9] rounded-xl py-2 px-4 focus:outline-none focus:border-[#FF8B5E] transition-colors duration-300",autoComplete:"off",onClick:e=>e.stopPropagation()}),s.jsx("button",{type:"submit",disabled:!u.trim(),className:"bg-gradient-to-r from-[#FFB996] to-[#FF8B5E] text-white p-2 rounded-xl disabled:opacity-50 flex items-center justify-center w-[42px] h-[42px] hover:shadow-md transition-all duration-300","aria-label":"Mesaj g\xf6nder",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})})]})})})]})]})}}};