"use strict";(()=>{var e={};e.id=8873,e.ids=[8873],e.modules={11185:e=>{e.exports=require("mongoose")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},32081:e=>{e.exports=require("child_process")},6113:e=>{e.exports=require("crypto")},9523:e=>{e.exports=require("dns")},82361:e=>{e.exports=require("events")},57147:e=>{e.exports=require("fs")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},41808:e=>{e.exports=require("net")},22037:e=>{e.exports=require("os")},71017:e=>{e.exports=require("path")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},12508:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>v,originalPathname:()=>x,patchFetch:()=>q,requestAsyncStorage:()=>A,routeModule:()=>h,serverHooks:()=>C,staticGenerationAsyncStorage:()=>w,staticGenerationBailout:()=>y});var i={};t.r(i),t.d(i,{OPTIONS:()=>g,POST:()=>f});var o=t(95419),n=t(69108),s=t(99678),a=t(78070),l=t(2544),u=t.n(l),d=t(46082),c=t.n(d),p=t(52055),m=t(22345);async function g(){return a.Z.json({},{headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, PUT, DELETE, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization","Access-Control-Allow-Credentials":"true"}})}async function f(e){try{let{email:r,password:i}=await e.json();if(!r||!i)return a.Z.json({error:"Email ve şifre zorunludur"},{status:400,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true"}});await (0,m.Z)(),console.log("Login attempt for email:",r);let o=await p.Z.findOne({email:r}).select("+password");if(!o)return a.Z.json({error:"Email veya şifre hatalı"},{status:401,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true"}});if(console.log("Found user:",{id:o._id?o._id.toString():"",name:o.name,email:o.email,role:o.role,university:o.university,isVerified:o.isVerified}),!o.isVerified){let{generateVerificationCode:e,sendVerificationEmail:r}=await Promise.all([t.e(8140),t.e(5988)]).then(t.bind(t,5988)),i=e(),n=new Date(Date.now()+6e5);o.verificationCode=i,o.verificationCodeExpires=n,await o.save();try{return await r(o.email,i),a.Z.json({error:"L\xfctfen \xf6nce email adresinizi doğrulayın",needsVerification:!0,email:o.email},{status:403,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true"}})}catch(e){return console.error("Doğrulama e-postası g\xf6nderme hatası:",e),a.Z.json({error:"Doğrulama e-postası g\xf6nderilirken bir hata oluştu"},{status:500,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true"}})}}if(!await u().compare(i,o.password))return a.Z.json({error:"Email veya şifre hatalı"},{status:401,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true"}});let n=c().sign({userId:o._id?o._id.toString():"",email:o.email,role:o.role},process.env.JWT_SECRET||"default-secret",{expiresIn:"7d"});console.log("Login successful, returning user data:",{id:o._id?o._id.toString():"",name:o.name,email:o.email,role:o.role,university:o.university,isVerified:o.isVerified});let s={id:o._id?o._id.toString():"",name:o.name,email:o.email,role:o.role,university:o.university,isVerified:o.isVerified};return a.Z.json({user:s,token:n},{status:200,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true"}})}catch(e){return console.error("Login error:",e),a.Z.json({error:"Giriş yapılırken bir hata oluştu"},{status:500,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true"}})}}let h=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"C:\\Users\\eren\\Kavun, organization\\app\\api\\auth\\login\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:A,staticGenerationAsyncStorage:w,serverHooks:C,headerHooks:v,staticGenerationBailout:y}=h,x="/api/auth/login/route";function q(){return(0,s.patchFetch)({serverHooks:C,staticGenerationAsyncStorage:w})}},22345:(e,r,t)=>{t.d(r,{Z:()=>a});var i=t(11185),o=t.n(i);let n=process.env.MONGODB_URI;if(!n)throw Error("MongoDB URI bulunamadı. L\xfctfen .env dosyasını kontrol edin.");let s=global.mongoose||{conn:null,promise:null};global.mongoose||(global.mongoose=s);let a=async function(){if(s.conn)return s.conn;s.promise||(s.promise=o().connect(n,{bufferCommands:!1}).then(e=>e));try{s.conn=await s.promise}catch(e){throw s.promise=null,e}return s.conn}},52055:(e,r,t)=>{t.d(r,{Z:()=>s});var i=t(11185),o=t.n(i);let n=new i.Schema({name:{type:String,required:[!0,"Ad alanı zorunludur"],trim:!0,minlength:[2,"Ad en az 2 karakter olmalıdır"],maxlength:[50,"Ad en fazla 50 karakter olabilir"]},email:{type:String,required:[!0,"Email alanı zorunludur"],unique:!0,trim:!0,lowercase:!0,validate:{validator:function(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)},message:"Ge\xe7erli bir email adresi giriniz"}},password:{type:String,required:[!0,"Şifre alanı zorunludur"],minlength:[8,"Şifre en az 8 karakter olmalıdır"],select:!1},role:{type:String,required:[!0,"Rol alanı zorunludur"],enum:{values:["student","teacher"],message:"Ge\xe7erli bir rol se\xe7iniz"}},university:{type:String,required:[!0,"\xdcniversite alanı zorunludur"],trim:!0},isVerified:{type:Boolean,default:!1},verificationCode:String,verificationCodeExpires:Date,resetPasswordCode:String,resetPasswordExpires:Date,expertise:{type:String,default:"",trim:!0},createdAt:{type:Date,default:Date.now}},{timestamps:!0,strict:!0,strictQuery:!0,collection:"users"});n.index({email:1},{unique:!0});try{o().deleteModel("User")}catch(e){}let s=o().model("User",n)}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),i=r.X(0,[1638,6206,6082,6521],()=>t(12508));module.exports=i})();