"use strict";(()=>{var e={};e.id=3002,e.ids=[3002,5988],e.modules={11185:e=>{e.exports=require("mongoose")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},32081:e=>{e.exports=require("child_process")},6113:e=>{e.exports=require("crypto")},9523:e=>{e.exports=require("dns")},82361:e=>{e.exports=require("events")},57147:e=>{e.exports=require("fs")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},41808:e=>{e.exports=require("net")},22037:e=>{e.exports=require("os")},71017:e=>{e.exports=require("path")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},33402:(e,r,o)=>{o.r(r),o.d(r,{headerHooks:()=>x,originalPathname:()=>k,patchFetch:()=>v,requestAsyncStorage:()=>y,routeModule:()=>h,serverHooks:()=>A,staticGenerationAsyncStorage:()=>f,staticGenerationBailout:()=>w});var a={};o.r(a),o.d(a,{OPTIONS:()=>m,POST:()=>g});var t=o(95419),s=o(69108),l=o(99678),n=o(78070),i=o(2544),c=o.n(i),u=o(52055),d=o(22345),p=o(5988);async function m(){return n.Z.json({},{headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, PUT, DELETE, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization","Access-Control-Allow-Credentials":"true"}})}async function g(e){console.log("Register endpoint \xe7ağrıldı");try{let r,o,a;try{console.log("Request body parse ediliyor..."),r=await e.json(),console.log("Request body:",{name:r.name,email:r.email,role:r.role,university:r.university,password:"***"})}catch(e){return console.error("Request body parse hatası:",e),n.Z.json({error:"Ge\xe7ersiz istek formatı"},{status:400,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true"}})}let{name:t,email:s,password:l,role:i,university:m}=r;if(!t||!s||!l||!i||!m)return console.log("Eksik alan hatası:",{name:!!t,email:!!s,password:!!l,role:!!i,university:!!m}),n.Z.json({error:"T\xfcm alanlar zorunludur"},{status:400,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true"}});if(!["student","teacher"].includes(i))return n.Z.json({error:"Ge\xe7ersiz rol"},{status:400,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true"}});console.log("MongoDB bağlantısı kuruluyor...");try{await (0,d.Z)(),console.log("MongoDB bağlantısı başarılı")}catch(e){return console.error("MongoDB bağlantı hatası:",e),n.Z.json({error:"Veritabanı bağlantı hatası"},{status:500,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true"}})}console.log("Email kontrol\xfc yapılıyor...");try{if(await u.Z.findOne({email:s}))return console.log("Email zaten kayıtlı:",s),n.Z.json({error:"Bu email adresi zaten kayıtlı"},{status:400,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true"}})}catch(e){return console.error("Email kontrol hatası:",e),n.Z.json({error:"Email kontrol\xfc sırasında bir hata oluştu"},{status:500,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true"}})}console.log("Şifre hashleniyor...");try{o=await c().hash(l,10)}catch(e){return console.error("Şifre hashleme hatası:",e),n.Z.json({error:"Şifre işlenirken bir hata oluştu"},{status:500,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true"}})}console.log("Doğrulama kodu oluşturuluyor...");let g=(0,p.generateVerificationCode)(),h=new Date(Date.now()+6e5);console.log("Kullanıcı oluşturuluyor...",{name:t,email:s,role:i,university:m,verificationCode:g,verificationCodeExpires:h,isVerified:!1});try{console.log("User model:",u.Z),console.log("User model schema:",u.Z.schema.obj);let e={name:t,email:s,password:o,role:i,university:m,verificationCode:g,verificationCodeExpires:h,isVerified:!1};console.log("Creating user with data:",e);try{a=await u.Z.create(e)}catch(e){throw console.error("User.create error:",{error:e,validationErrors:e.errors,code:e.code,message:e.message}),e}console.log("Kullanıcı oluşturuldu:",{id:a._id,name:a.name,email:a.email,role:a.role,university:a.university,isVerified:a.isVerified});let r=await u.Z.findById(a._id).lean();console.log("MongoDB'den kontrol:",r)}catch(e){if(console.error("Kullanıcı oluşturma hatası:",e),11e3===e.code)return n.Z.json({error:"Bu email adresi zaten kayıtlı"},{status:400,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true"}});return n.Z.json({error:"Kullanıcı oluşturulurken bir hata oluştu"},{status:500,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true"}})}console.log("Doğrulama e-postası g\xf6nderiliyor...");try{await (0,p.sendVerificationEmail)(s,g),console.log("Doğrulama e-postası g\xf6nderildi")}catch(e){console.error("Email g\xf6nderme hatası:",e)}return n.Z.json({message:"Kayıt başarılı! L\xfctfen e-posta adresinizi doğrulayın.",redirectUrl:`/auth/verify?email=${encodeURIComponent(s)}`,email:s,role:i},{status:201,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true"}})}catch(e){return console.error("Register endpoint hatası:",e),n.Z.json({error:"Kayıt sırasında bir hata oluştu"},{status:500,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true"}})}}let h=new t.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/auth/register/route",pathname:"/api/auth/register",filename:"route",bundlePath:"app/api/auth/register/route"},resolvedPagePath:"C:\\Users\\eren\\Kavun, organization\\app\\api\\auth\\register\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:y,staticGenerationAsyncStorage:f,serverHooks:A,headerHooks:x,staticGenerationBailout:w}=h,k="/api/auth/register/route";function v(){return(0,l.patchFetch)({serverHooks:A,staticGenerationAsyncStorage:f})}},5988:(e,r,o)=>{o.d(r,{L:()=>n,generateVerificationCode:()=>s,sendVerificationEmail:()=>l});var a=o(68140);let t=()=>{console.log("Email transporter oluşturuluyor...");let e=process.env.EMAIL_USER,r=process.env.EMAIL_PASSWORD;if(!e||!r)throw Error("Email ayarları eksik. L\xfctfen .env dosyasında EMAIL_USER ve EMAIL_PASSWORD değerlerini kontrol edin.");return console.log("Email ayarları kontrol edildi:",{emailUser:e}),a.createTransport({host:"smtp.gmail.com",port:465,secure:!0,auth:{user:e,pass:r},debug:!0})},s=()=>Math.floor(1e5+9e5*Math.random()).toString(),l=async(e,r)=>{console.log("Doğrulama e-postası g\xf6nderme işlemi başladı:",e);try{let o=t();console.log("SMTP bağlantısı test ediliyor...");try{let e=await o.verify();console.log("SMTP bağlantısı başarılı:",e)}catch(e){throw console.error("SMTP bağlantı hatası:",e),Error("SMTP sunucusuna bağlanılamadı. L\xfctfen email ayarlarınızı kontrol edin.")}let a={from:{name:"Kavun App",address:process.env.EMAIL_USER},to:e,subject:"E-posta Doğrulama Kodu - Kavun App",html:`
        <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
          <h2 style="color: #333; text-align: center;">Kavun App E-posta Doğrulama</h2>
          <p style="color: #666; font-size: 16px;">Merhaba,</p>
          <p style="color: #666; font-size: 16px;">Kavun App'e hoş geldiniz. L\xfctfen aşağıdaki doğrulama kodunu kullanarak e-posta adresinizi doğrulayın:</p>
          <div style="background-color: #f5f5f5; padding: 20px; text-align: center; margin: 20px 0;">
            <h1 style="color: #333; letter-spacing: 5px; margin: 0;">${r}</h1>
          </div>
          <p style="color: #666; font-size: 14px;">Bu kod 10 dakika s\xfcreyle ge\xe7erlidir.</p>
          <p style="color: #666; font-size: 14px;">Eğer bu işlemi siz yapmadıysanız, l\xfctfen bu e-postayı dikkate almayın.</p>
          <hr style="border: 1px solid #eee; margin: 20px 0;">
          <p style="color: #999; font-size: 12px; text-align: center;">Bu e-posta otomatik olarak g\xf6nderilmiştir, l\xfctfen yanıtlamayınız.</p>
        </div>
      `};console.log("E-posta g\xf6nderiliyor...");let s=await o.sendMail(a);return console.log("E-posta g\xf6nderildi:",{messageId:s.messageId,response:s.response,accepted:s.accepted,rejected:s.rejected}),!0}catch(e){throw console.error("E-posta g\xf6nderme hatası:",{name:e.name,message:e.message,code:e.code,command:e.command,stack:e.stack}),e}},n=async(e,r)=>{console.log("Şifre sıfırlama e-postası g\xf6nderme işlemi başladı:",e);try{let o=t();console.log("SMTP bağlantısı test ediliyor...");try{let e=await o.verify();console.log("SMTP bağlantısı başarılı:",e)}catch(e){throw console.error("SMTP bağlantı hatası:",e),Error("SMTP sunucusuna bağlanılamadı. L\xfctfen email ayarlarınızı kontrol edin.")}let a={from:{name:"Kavun App",address:process.env.EMAIL_USER},to:e,subject:"Şifre Sıfırlama - Kavun App",html:`
        <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
          <h2 style="color: #333; text-align: center;">Kavun App Şifre Sıfırlama</h2>
          <p style="color: #666; font-size: 16px;">Merhaba,</p>
          <p style="color: #666; font-size: 16px;">Şifrenizi sıfırlamak i\xe7in talepte bulundunuz. L\xfctfen aşağıdaki kodu kullanarak şifrenizi sıfırlayın:</p>
          <div style="background-color: #f5f5f5; padding: 20px; text-align: center; margin: 20px 0;">
            <h1 style="color: #333; letter-spacing: 5px; margin: 0;">${r}</h1>
          </div>
          <p style="color: #666; font-size: 14px;">Bu kod 10 dakika s\xfcreyle ge\xe7erlidir.</p>
          <p style="color: #666; font-size: 14px;">Eğer bu işlemi siz yapmadıysanız, l\xfctfen bu e-postayı dikkate almayın ve hesabınızın g\xfcvenliği i\xe7in şifrenizi değiştirin.</p>
          <hr style="border: 1px solid #eee; margin: 20px 0;">
          <p style="color: #999; font-size: 12px; text-align: center;">Bu e-posta otomatik olarak g\xf6nderilmiştir, l\xfctfen yanıtlamayınız.</p>
        </div>
      `};console.log("E-posta g\xf6nderiliyor...");let s=await o.sendMail(a);return console.log("E-posta g\xf6nderildi:",{messageId:s.messageId,response:s.response,accepted:s.accepted,rejected:s.rejected}),!0}catch(e){throw console.error("E-posta g\xf6nderme hatası:",{name:e.name,message:e.message,code:e.code,command:e.command,stack:e.stack}),e}}},22345:(e,r,o)=>{o.d(r,{Z:()=>n});var a=o(11185),t=o.n(a);let s=process.env.MONGODB_URI;if(!s)throw Error("MongoDB URI bulunamadı. L\xfctfen .env dosyasını kontrol edin.");let l=global.mongoose||{conn:null,promise:null};global.mongoose||(global.mongoose=l);let n=async function(){if(l.conn)return l.conn;l.promise||(l.promise=t().connect(s,{bufferCommands:!1}).then(e=>e));try{l.conn=await l.promise}catch(e){throw l.promise=null,e}return l.conn}},52055:(e,r,o)=>{o.d(r,{Z:()=>l});var a=o(11185),t=o.n(a);let s=new a.Schema({name:{type:String,required:[!0,"Ad alanı zorunludur"],trim:!0,minlength:[2,"Ad en az 2 karakter olmalıdır"],maxlength:[50,"Ad en fazla 50 karakter olabilir"]},email:{type:String,required:[!0,"Email alanı zorunludur"],unique:!0,trim:!0,lowercase:!0,validate:{validator:function(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)},message:"Ge\xe7erli bir email adresi giriniz"}},password:{type:String,required:[!0,"Şifre alanı zorunludur"],minlength:[8,"Şifre en az 8 karakter olmalıdır"],select:!1},role:{type:String,required:[!0,"Rol alanı zorunludur"],enum:{values:["student","teacher"],message:"Ge\xe7erli bir rol se\xe7iniz"}},university:{type:String,required:[!0,"\xdcniversite alanı zorunludur"],trim:!0},isVerified:{type:Boolean,default:!1},verificationCode:String,verificationCodeExpires:Date,resetPasswordCode:String,resetPasswordExpires:Date,expertise:{type:String,default:"",trim:!0},createdAt:{type:Date,default:Date.now}},{timestamps:!0,strict:!0,strictQuery:!0,collection:"users"});s.index({email:1},{unique:!0});try{t().deleteModel("User")}catch(e){}let l=t().model("User",s)}};var r=require("../../../../webpack-runtime.js");r.C(e);var o=e=>r(r.s=e),a=r.X(0,[1638,6206,6521,8140],()=>o(33402));module.exports=a})();