"use strict";(()=>{var e={};e.id=571,e.ids=[571],e.modules={11185:e=>{e.exports=require("mongoose")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},12781:e=>{e.exports=require("stream")},73837:e=>{e.exports=require("util")},51829:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>v,originalPathname:()=>A,patchFetch:()=>y,requestAsyncStorage:()=>p,routeModule:()=>m,serverHooks:()=>g,staticGenerationAsyncStorage:()=>f,staticGenerationBailout:()=>h});var i={};t.r(i),t.d(i,{OPTIONS:()=>d,POST:()=>c});var o=t(95419),a=t(69108),n=t(99678),s=t(78070),l=t(52055),u=t(22345);async function d(){return s.Z.json({},{headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, PUT, DELETE, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization","Access-Control-Allow-Credentials":"true"}})}async function c(e){try{let{email:r,code:i}=await e.json();if(!r||!i)return s.Z.json({error:"Email ve doğrulama kodu gereklidir"},{status:400,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true"}});await (0,u.Z)();let o=await l.Z.findOne({email:r,verificationCode:i,verificationCodeExpires:{$gt:new Date},isVerified:!1});if(!o)return s.Z.json({error:"Ge\xe7ersiz veya s\xfcresi dolmuş doğrulama kodu"},{status:400,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true"}});o.isVerified=!0,o.verificationCode=void 0,o.verificationCodeExpires=void 0,await o.save();let a=(await t.e(6082).then(t.t.bind(t,46082,23))).default.sign({userId:o._id.toString(),email:o.email,role:o.role},process.env.JWT_SECRET||"default-secret",{expiresIn:"7d"}),n={id:o._id.toString(),name:o.name,email:o.email,role:o.role,university:o.university,isVerified:!0,expertise:o.expertise};return s.Z.json({message:"Email başarıyla doğrulandı",user:n,token:a},{status:200,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true"}})}catch(e){return console.error("Verify error:",e),s.Z.json({error:"Email doğrulama sırasında bir hata oluştu"},{status:500,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true"}})}}let m=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/auth/verify/route",pathname:"/api/auth/verify",filename:"route",bundlePath:"app/api/auth/verify/route"},resolvedPagePath:"C:\\Users\\eren\\Kavun, organization\\app\\api\\auth\\verify\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:p,staticGenerationAsyncStorage:f,serverHooks:g,headerHooks:v,staticGenerationBailout:h}=m,A="/api/auth/verify/route";function y(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:f})}},22345:(e,r,t)=>{t.d(r,{Z:()=>s});var i=t(11185),o=t.n(i);let a=process.env.MONGODB_URI;if(!a)throw Error("MongoDB URI bulunamadı. L\xfctfen .env dosyasını kontrol edin.");let n=global.mongoose||{conn:null,promise:null};global.mongoose||(global.mongoose=n);let s=async function(){if(n.conn)return n.conn;n.promise||(n.promise=o().connect(a,{bufferCommands:!1}).then(e=>e));try{n.conn=await n.promise}catch(e){throw n.promise=null,e}return n.conn}},52055:(e,r,t)=>{t.d(r,{Z:()=>n});var i=t(11185),o=t.n(i);let a=new i.Schema({name:{type:String,required:[!0,"Ad alanı zorunludur"],trim:!0,minlength:[2,"Ad en az 2 karakter olmalıdır"],maxlength:[50,"Ad en fazla 50 karakter olabilir"]},email:{type:String,required:[!0,"Email alanı zorunludur"],unique:!0,trim:!0,lowercase:!0,validate:{validator:function(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)},message:"Ge\xe7erli bir email adresi giriniz"}},password:{type:String,required:[!0,"Şifre alanı zorunludur"],minlength:[8,"Şifre en az 8 karakter olmalıdır"],select:!1},role:{type:String,required:[!0,"Rol alanı zorunludur"],enum:{values:["student","teacher"],message:"Ge\xe7erli bir rol se\xe7iniz"}},university:{type:String,required:[!0,"\xdcniversite alanı zorunludur"],trim:!0},isVerified:{type:Boolean,default:!1},verificationCode:String,verificationCodeExpires:Date,resetPasswordCode:String,resetPasswordExpires:Date,expertise:{type:String,default:"",trim:!0},createdAt:{type:Date,default:Date.now}},{timestamps:!0,strict:!0,strictQuery:!0,collection:"users"});a.index({email:1},{unique:!0});try{o().deleteModel("User")}catch(e){}let n=o().model("User",a)}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),i=r.X(0,[1638,6206],()=>t(51829));module.exports=i})();