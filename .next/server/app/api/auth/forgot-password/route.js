"use strict";(()=>{var e={};e.id=9118,e.ids=[9118,5988],e.modules={11185:e=>{e.exports=require("mongoose")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},32081:e=>{e.exports=require("child_process")},6113:e=>{e.exports=require("crypto")},9523:e=>{e.exports=require("dns")},82361:e=>{e.exports=require("events")},57147:e=>{e.exports=require("fs")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},41808:e=>{e.exports=require("net")},22037:e=>{e.exports=require("os")},71017:e=>{e.exports=require("path")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},83365:(e,r,a)=>{a.r(r),a.d(r,{headerHooks:()=>h,originalPathname:()=>A,patchFetch:()=>w,requestAsyncStorage:()=>g,routeModule:()=>m,serverHooks:()=>y,staticGenerationAsyncStorage:()=>f,staticGenerationBailout:()=>x});var o={};a.r(o),a.d(o,{OPTIONS:()=>u,POST:()=>p});var t=a(95419),s=a(69108),n=a(99678),l=a(78070),i=a(52055),d=a(22345),c=a(5988);async function u(){return l.Z.json({},{headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, PUT, DELETE, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization","Access-Control-Allow-Credentials":"true"}})}async function p(e){console.log("Şifre sıfırlama endpoint \xe7ağrıldı");try{let r,a;try{console.log("Request body parse ediliyor..."),r=await e.json(),console.log("Request body:",{email:r.email})}catch(e){return console.error("Request body parse hatası:",e),l.Z.json({error:"Ge\xe7ersiz istek formatı"},{status:400,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true"}})}let{email:o}=r;if(!o)return console.log("Email adresi eksik"),l.Z.json({error:"Email adresi zorunludur"},{status:400,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true"}});console.log("MongoDB bağlantısı kuruluyor...");try{await (0,d.Z)(),console.log("MongoDB bağlantısı başarılı")}catch(e){return console.error("MongoDB bağlantı hatası:",e),l.Z.json({error:"Veritabanı bağlantı hatası"},{status:500,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true"}})}console.log("Kullanıcı aranıyor:",o);try{if(!(a=await i.Z.findOne({email:o})))return console.log("Kullanıcı bulunamadı:",o),l.Z.json({message:"Şifre sıfırlama talimatları email adresinize g\xf6nderildi",redirectUrl:`/auth/reset-password?email=${encodeURIComponent(o)}`},{status:200,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true"}});console.log("Doğrulama kodu oluşturuluyor...");let e=(0,c.generateVerificationCode)(),r=new Date(Date.now()+6e5);return a.resetPasswordCode=e,a.resetPasswordExpires=r,await a.save(),console.log("Şifre sıfırlama e-postası g\xf6nderiliyor..."),await (0,c.L)(o,e),console.log("Şifre sıfırlama e-postası g\xf6nderildi"),l.Z.json({message:"Şifre sıfırlama talimatları email adresinize g\xf6nderildi",redirectUrl:`/auth/reset-password?email=${encodeURIComponent(o)}`},{status:200,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true"}})}catch(e){return console.error("Şifre sıfırlama hatası:",e),l.Z.json({error:"Şifre sıfırlama işlemi sırasında bir hata oluştu"},{status:500,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true"}})}}catch(e){return console.error("Genel hata:",{message:e.message,stack:e.stack,name:e.name}),l.Z.json({error:"İşlem sırasında bir hata oluştu"},{status:500,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true"}})}}let m=new t.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/auth/forgot-password/route",pathname:"/api/auth/forgot-password",filename:"route",bundlePath:"app/api/auth/forgot-password/route"},resolvedPagePath:"C:\\Users\\eren\\Kavun, organization\\app\\api\\auth\\forgot-password\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:g,staticGenerationAsyncStorage:f,serverHooks:y,headerHooks:h,staticGenerationBailout:x}=m,A="/api/auth/forgot-password/route";function w(){return(0,n.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:f})}},5988:(e,r,a)=>{a.d(r,{L:()=>l,generateVerificationCode:()=>s,sendVerificationEmail:()=>n});var o=a(68140);let t=()=>{console.log("Email transporter oluşturuluyor...");let e=process.env.EMAIL_USER,r=process.env.EMAIL_PASSWORD;if(!e||!r)throw Error("Email ayarları eksik. L\xfctfen .env dosyasında EMAIL_USER ve EMAIL_PASSWORD değerlerini kontrol edin.");return console.log("Email ayarları kontrol edildi:",{emailUser:e}),o.createTransport({host:"smtp.gmail.com",port:465,secure:!0,auth:{user:e,pass:r},debug:!0})},s=()=>Math.floor(1e5+9e5*Math.random()).toString(),n=async(e,r)=>{console.log("Doğrulama e-postası g\xf6nderme işlemi başladı:",e);try{let a=t();console.log("SMTP bağlantısı test ediliyor...");try{let e=await a.verify();console.log("SMTP bağlantısı başarılı:",e)}catch(e){throw console.error("SMTP bağlantı hatası:",e),Error("SMTP sunucusuna bağlanılamadı. L\xfctfen email ayarlarınızı kontrol edin.")}let o={from:{name:"Kavun App",address:process.env.EMAIL_USER},to:e,subject:"E-posta Doğrulama Kodu - Kavun App",html:`
        <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
          <h2 style="color: #333; text-align: center;">Kavun App E-posta Doğrulama</h2>
          <p style="color: #666; font-size: 16px;">Merhaba,</p>
          <p style="color: #666; font-size: 16px;">Kavun App'e hoş geldiniz. L\xfctfen aşağıdaki doğrulama kodunu kullanarak e-posta adresinizi doğrulayın:</p>
          <div style="background-color: #f5f5f5; padding: 20px; text-align: center; margin: 20px 0;">
            <h1 style="color: #333; letter-spacing: 5px; margin: 0;">${r}</h1>
          </div>
          <p style="color: #666; font-size: 14px;">Bu kod 10 dakika s\xfcreyle ge\xe7erlidir.</p>
          <p style="color: #666; font-size: 14px;">Eğer bu işlemi siz yapmadıysanız, l\xfctfen bu e-postayı dikkate almayın.</p>
          <hr style="border: 1px solid #eee; margin: 20px 0;">
          <p style="color: #999; font-size: 12px; text-align: center;">Bu e-posta otomatik olarak g\xf6nderilmiştir, l\xfctfen yanıtlamayınız.</p>
        </div>
      `};console.log("E-posta g\xf6nderiliyor...");let s=await a.sendMail(o);return console.log("E-posta g\xf6nderildi:",{messageId:s.messageId,response:s.response,accepted:s.accepted,rejected:s.rejected}),!0}catch(e){throw console.error("E-posta g\xf6nderme hatası:",{name:e.name,message:e.message,code:e.code,command:e.command,stack:e.stack}),e}},l=async(e,r)=>{console.log("Şifre sıfırlama e-postası g\xf6nderme işlemi başladı:",e);try{let a=t();console.log("SMTP bağlantısı test ediliyor...");try{let e=await a.verify();console.log("SMTP bağlantısı başarılı:",e)}catch(e){throw console.error("SMTP bağlantı hatası:",e),Error("SMTP sunucusuna bağlanılamadı. L\xfctfen email ayarlarınızı kontrol edin.")}let o={from:{name:"Kavun App",address:process.env.EMAIL_USER},to:e,subject:"Şifre Sıfırlama - Kavun App",html:`
        <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
          <h2 style="color: #333; text-align: center;">Kavun App Şifre Sıfırlama</h2>
          <p style="color: #666; font-size: 16px;">Merhaba,</p>
          <p style="color: #666; font-size: 16px;">Şifrenizi sıfırlamak i\xe7in talepte bulundunuz. L\xfctfen aşağıdaki kodu kullanarak şifrenizi sıfırlayın:</p>
          <div style="background-color: #f5f5f5; padding: 20px; text-align: center; margin: 20px 0;">
            <h1 style="color: #333; letter-spacing: 5px; margin: 0;">${r}</h1>
          </div>
          <p style="color: #666; font-size: 14px;">Bu kod 10 dakika s\xfcreyle ge\xe7erlidir.</p>
          <p style="color: #666; font-size: 14px;">Eğer bu işlemi siz yapmadıysanız, l\xfctfen bu e-postayı dikkate almayın ve hesabınızın g\xfcvenliği i\xe7in şifrenizi değiştirin.</p>
          <hr style="border: 1px solid #eee; margin: 20px 0;">
          <p style="color: #999; font-size: 12px; text-align: center;">Bu e-posta otomatik olarak g\xf6nderilmiştir, l\xfctfen yanıtlamayınız.</p>
        </div>
      `};console.log("E-posta g\xf6nderiliyor...");let s=await a.sendMail(o);return console.log("E-posta g\xf6nderildi:",{messageId:s.messageId,response:s.response,accepted:s.accepted,rejected:s.rejected}),!0}catch(e){throw console.error("E-posta g\xf6nderme hatası:",{name:e.name,message:e.message,code:e.code,command:e.command,stack:e.stack}),e}}},22345:(e,r,a)=>{a.d(r,{Z:()=>l});var o=a(11185),t=a.n(o);let s=process.env.MONGODB_URI;if(!s)throw Error("MongoDB URI bulunamadı. L\xfctfen .env dosyasını kontrol edin.");let n=global.mongoose||{conn:null,promise:null};global.mongoose||(global.mongoose=n);let l=async function(){if(n.conn)return n.conn;n.promise||(n.promise=t().connect(s,{bufferCommands:!1}).then(e=>e));try{n.conn=await n.promise}catch(e){throw n.promise=null,e}return n.conn}},52055:(e,r,a)=>{a.d(r,{Z:()=>n});var o=a(11185),t=a.n(o);let s=new o.Schema({name:{type:String,required:[!0,"Ad alanı zorunludur"],trim:!0,minlength:[2,"Ad en az 2 karakter olmalıdır"],maxlength:[50,"Ad en fazla 50 karakter olabilir"]},email:{type:String,required:[!0,"Email alanı zorunludur"],unique:!0,trim:!0,lowercase:!0,validate:{validator:function(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)},message:"Ge\xe7erli bir email adresi giriniz"}},password:{type:String,required:[!0,"Şifre alanı zorunludur"],minlength:[8,"Şifre en az 8 karakter olmalıdır"],select:!1},role:{type:String,required:[!0,"Rol alanı zorunludur"],enum:{values:["student","teacher"],message:"Ge\xe7erli bir rol se\xe7iniz"}},university:{type:String,required:[!0,"\xdcniversite alanı zorunludur"],trim:!0},isVerified:{type:Boolean,default:!1},verificationCode:String,verificationCodeExpires:Date,resetPasswordCode:String,resetPasswordExpires:Date,expertise:{type:String,default:"",trim:!0},createdAt:{type:Date,default:Date.now}},{timestamps:!0,strict:!0,strictQuery:!0,collection:"users"});s.index({email:1},{unique:!0});try{t().deleteModel("User")}catch(e){}let n=t().model("User",s)}};var r=require("../../../../webpack-runtime.js");r.C(e);var a=e=>r(r.s=e),o=r.X(0,[1638,6206,8140],()=>a(83365));module.exports=o})();