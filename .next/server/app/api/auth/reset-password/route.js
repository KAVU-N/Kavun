"use strict";(()=>{var e={};e.id=9436,e.ids=[9436],e.modules={11185:e=>{e.exports=require("mongoose")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},32791:(e,r,o)=>{o.r(r),o.d(r,{headerHooks:()=>C,originalPathname:()=>y,patchFetch:()=>v,requestAsyncStorage:()=>h,routeModule:()=>m,serverHooks:()=>w,staticGenerationAsyncStorage:()=>A,staticGenerationBailout:()=>f});var t={};o.r(t),o.d(t,{OPTIONS:()=>g,POST:()=>p});var s=o(95419),a=o(69108),n=o(99678),l=o(78070),i=o(2544),u=o.n(i),c=o(52055),d=o(22345);async function g(){return l.Z.json({},{headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, PUT, DELETE, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization","Access-Control-Allow-Credentials":"true"}})}async function p(e){console.log("Şifre sıfırlama endpoint \xe7ağrıldı");try{let r,o;try{console.log("Request body parse ediliyor..."),r=await e.json(),console.log("Request body:",{email:r.email,code:r.code})}catch(e){return console.error("Request body parse hatası:",e),l.Z.json({error:"Ge\xe7ersiz istek formatı"},{status:400,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true"}})}let{email:t,code:s,password:a}=r;if(!t||!s||!a)return console.log("Eksik alan hatası:",{email:!!t,code:!!s,password:!!a}),l.Z.json({error:"T\xfcm alanlar zorunludur"},{status:400,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true"}});if(a.length<8)return l.Z.json({error:"Şifre en az 8 karakter olmalıdır"},{status:400,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true"}});console.log("MongoDB bağlantısı kuruluyor...");try{await (0,d.Z)(),console.log("MongoDB bağlantısı başarılı")}catch(e){return console.error("MongoDB bağlantı hatası:",e),l.Z.json({error:"Veritabanı bağlantı hatası"},{status:500,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true"}})}console.log("Kullanıcı aranıyor:",t);try{if(!(o=await c.Z.findOne({email:t,resetPasswordCode:s,resetPasswordExpires:{$gt:Date.now()}})))return console.log("Ge\xe7ersiz veya s\xfcresi dolmuş kod"),l.Z.json({error:"Ge\xe7ersiz veya s\xfcresi dolmuş kod"},{status:400,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true"}});console.log("Şifre hashleniyor...");let e=await u().hash(a,10);return o.password=e,o.resetPasswordCode=void 0,o.resetPasswordExpires=void 0,await o.save(),console.log("Şifre başarıyla g\xfcncellendi"),l.Z.json({message:"Şifreniz başarıyla g\xfcncellendi"},{status:200,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true"}})}catch(e){return console.error("Şifre g\xfcncelleme hatası:",e),l.Z.json({error:"Şifre g\xfcncellenirken bir hata oluştu"},{status:500,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true"}})}}catch(e){return console.error("Genel hata:",{message:e.message,stack:e.stack,name:e.name}),l.Z.json({error:"İşlem sırasında bir hata oluştu"},{status:500,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true"}})}}let m=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/auth/reset-password/route",pathname:"/api/auth/reset-password",filename:"route",bundlePath:"app/api/auth/reset-password/route"},resolvedPagePath:"C:\\Users\\eren\\Kavun, organization\\app\\api\\auth\\reset-password\\route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:h,staticGenerationAsyncStorage:A,serverHooks:w,headerHooks:C,staticGenerationBailout:f}=m,y="/api/auth/reset-password/route";function v(){return(0,n.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:A})}},22345:(e,r,o)=>{o.d(r,{Z:()=>l});var t=o(11185),s=o.n(t);let a=process.env.MONGODB_URI;if(!a)throw Error("MongoDB URI bulunamadı. L\xfctfen .env dosyasını kontrol edin.");let n=global.mongoose||{conn:null,promise:null};global.mongoose||(global.mongoose=n);let l=async function(){if(n.conn)return n.conn;n.promise||(n.promise=s().connect(a,{bufferCommands:!1}).then(e=>e));try{n.conn=await n.promise}catch(e){throw n.promise=null,e}return n.conn}},52055:(e,r,o)=>{o.d(r,{Z:()=>n});var t=o(11185),s=o.n(t);let a=new t.Schema({name:{type:String,required:[!0,"Ad alanı zorunludur"],trim:!0,minlength:[2,"Ad en az 2 karakter olmalıdır"],maxlength:[50,"Ad en fazla 50 karakter olabilir"]},email:{type:String,required:[!0,"Email alanı zorunludur"],unique:!0,trim:!0,lowercase:!0,validate:{validator:function(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)},message:"Ge\xe7erli bir email adresi giriniz"}},password:{type:String,required:[!0,"Şifre alanı zorunludur"],minlength:[8,"Şifre en az 8 karakter olmalıdır"],select:!1},role:{type:String,required:[!0,"Rol alanı zorunludur"],enum:{values:["student","teacher"],message:"Ge\xe7erli bir rol se\xe7iniz"}},university:{type:String,required:[!0,"\xdcniversite alanı zorunludur"],trim:!0},isVerified:{type:Boolean,default:!1},verificationCode:String,verificationCodeExpires:Date,resetPasswordCode:String,resetPasswordExpires:Date,expertise:{type:String,default:"",trim:!0},createdAt:{type:Date,default:Date.now}},{timestamps:!0,strict:!0,strictQuery:!0,collection:"users"});a.index({email:1},{unique:!0});try{s().deleteModel("User")}catch(e){}let n=s().model("User",a)}};var r=require("../../../../webpack-runtime.js");r.C(e);var o=e=>r(r.s=e),t=r.X(0,[1638,6206,6521],()=>o(32791));module.exports=t})();